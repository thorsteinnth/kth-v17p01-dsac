{"paragraphs":[{"text":"%md\n\n### Build an Eventually Perfect Failure Detector\n\nAn Eventually Perfect Failure Detector (EPFD), in Kompics terms,  is a component that **provides** the following port *(already imported in the notebook)*.\n\n    class EventuallyPerfectFailureDetector extends Port {\n     indication[Suspect];\n     indication[Restore];\n    }\n\nSimply put, your component should indicate to an epfd port the following messages:\n\n    case class Suspect(process: Address) extends KompicsEvent;\n    case class Restore(process: Address) extends KompicsEvent;\n\nAs you have already learnt from the course lectures, an EPFD, defined in a partially synchronous model, should satisfy the following properties:\n\n1. **Completeness**:  *Every process that crashes should be eventually suspected permanently by every correct process*\n2. **Eventual Strong Accuracy**: *No correct process should be eventually suspected by any other correct process*\n   \nTo complete this assignment you will have to fill in the missing functionality denoted by the commented sections below and pass the property checking test at the end of this notebook.\n**HINT**: The recommended algorithm to use in this assignment is *EPFD with Increasing Timeout and Sequence Numbers*,  which you can find at the second page of this [document](https://courses.edx.org/asset-v1:KTHx+ID2203.1x+2016T3+type@asset+block@epfd.pdf) in the respective lecture.\n\n**Things to Remember**:\n1. The *Network* and *Timer* components are already provided by the simulator. No need to implement them.\n2. Execute the imports defined below **before** compiling your component implementation.\n3. We recommend making use of the component state and internal messages defined below to complete the implementation logic.\n4. You can always print messages to the output log, from within handlers to see what happens during the simulation. e.g. `println(s\"Process $self suspects $someProcess\");`\n5. Do not forget to run the checker code block in the end and ensure that all properties are satisfied before exporting your submission.\n6. You can always restart the Kompics Interpreter to start fresh (Interpreter->KompicsInterpreter->Click Restart)\n\nGood luck! :)","dateUpdated":"2017-02-13T20:50:58+0000","config":{"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"editorMode":"ace/mode/markdown","editorHide":true,"colWidth":12},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1487019058848_-40267536","id":"20160909-160459_701472878","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>Build an Eventually Perfect Failure Detector</h3>\n<p>An Eventually Perfect Failure Detector (EPFD), in Kompics terms,  is a component that <strong>provides</strong> the following port <em>(already imported in the notebook)</em>.</p>\n<pre><code>class EventuallyPerfectFailureDetector extends Port {\n indication[Suspect];\n indication[Restore];\n}\n</code></pre>\n<p>Simply put, your component should indicate to an epfd port the following messages:</p>\n<pre><code>case class Suspect(process: Address) extends KompicsEvent;\ncase class Restore(process: Address) extends KompicsEvent;\n</code></pre>\n<p>As you have already learnt from the course lectures, an EPFD, defined in a partially synchronous model, should satisfy the following properties:</p>\n<ol>\n<li><strong>Completeness</strong>:  <em>Every process that crashes should be eventually suspected permanently by every correct process</em></li>\n<li><strong>Eventual Strong Accuracy</strong>: <em>No correct process should be eventually suspected by any other correct process</em></li>\n</ol>\n<p>To complete this assignment you will have to fill in the missing functionality denoted by the commented sections below and pass the property checking test at the end of this notebook.\n<br  /><strong>HINT</strong>: The recommended algorithm to use in this assignment is <em>EPFD with Increasing Timeout and Sequence Numbers</em>,  which you can find at the second page of this <a href=\"https://courses.edx.org/asset-v1:KTHx+ID2203.1x+2016T3+type@asset+block@epfd.pdf\">document</a> in the respective lecture.</p>\n<p><strong>Things to Remember</strong>:</p>\n<ol>\n<li>The <em>Network</em> and <em>Timer</em> components are already provided by the simulator. No need to implement them.</li>\n<li>Execute the imports defined below <strong>before</strong> compiling your component implementation.</li>\n<li>We recommend making use of the component state and internal messages defined below to complete the implementation logic.</li>\n<li>You can always print messages to the output log, from within handlers to see what happens during the simulation. e.g. <code>println(s\"Process $self suspects $someProcess\");</code></li>\n<li>Do not forget to run the checker code block in the end and ensure that all properties are satisfied before exporting your submission.</li>\n<li>You can always restart the Kompics Interpreter to start fresh (Interpreter->KompicsInterpreter->Click Restart)</li>\n</ol>\n<p>Good luck! :)</p>\n"},"dateCreated":"2017-02-13T20:50:58+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:827"},{"text":"import se.kth.edx.id2203.core.Ports._\nimport se.kth.edx.id2203.validation._\nimport se.sics.kompics.network._\nimport se.sics.kompics.sl.{Init, _}\nimport se.sics.kompics.timer.{ScheduleTimeout, Timeout, Timer}\nimport se.sics.kompics.{KompicsEvent, Start, ComponentDefinition => _, Port => _}","dateUpdated":"2017-02-14T11:55:18+0000","config":{"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"editorMode":"ace/mode/scala","editorHide":false,"colWidth":12},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1487019058854_-41037034","id":"20160623-152816_923395673","result":{"code":"SUCCESS","type":"HTML","msg":"import se.kth.edx.id2203.core.Ports._<br />import se.kth.edx.id2203.validation._<br />import se.sics.kompics.network._<br />import se.sics.kompics.sl.{Init, _}<br />import se.sics.kompics.timer.{ScheduleTimeout, Timeout, Timer}<br />import se.sics.kompics.{KompicsEvent, Start, ComponentDefinition=>_, Port=>_}<br />"},"dateCreated":"2017-02-13T20:50:58+0000","dateStarted":"2017-02-14T11:55:18+0000","dateFinished":"2017-02-14T11:55:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:828","focus":true},{"text":"  //Custom messages to be used in the internal component implementation\n  case class CheckTimeout(timeout: ScheduleTimeout) extends Timeout(timeout);\n\n  case class HeartbeatReply(seq: Int) extends KompicsEvent;\n  case class HeartbeatRequest(seq: Int) extends KompicsEvent;","dateUpdated":"2017-02-14T11:55:19+0000","config":{"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"editorMode":"ace/mode/scala","colWidth":12},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1487019058855_-41421783","id":"20160830-153841_517626554","result":{"code":"SUCCESS","type":"HTML","msg":"defined class CheckTimeout<br />defined class HeartbeatReply<br />defined class HeartbeatRequest<br />"},"dateCreated":"2017-02-13T20:50:58+0000","dateStarted":"2017-02-14T11:55:20+0000","dateFinished":"2017-02-14T11:55:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:829","focus":true},{"text":"\n//Define EPFD Implementation\nclass EPFD(epfdInit: Init[EPFD]) extends ComponentDefinition {\n    \n  //EPFD subscriptions\n  val timer = requires[Timer];\n  val pLink = requires[PerfectLink];\n  val epfd = provides[EventuallyPerfectFailureDetector];\n\n  // EPDF component state and initialization\n  \n  //configuration parameters\n  val self = epfdInit match {case Init(s: Address) => s};\n  val topology = cfg.getValue[List[Address]](\"epfd.simulation.topology\");\n  val delta = cfg.getValue[Long](\"epfd.simulation.delay\");\n  \n  //mutable state\n  var period = cfg.getValue[Long](\"epfd.simulation.delay\");\n  var alive = Set(cfg.getValue[List[Address]](\"epfd.simulation.topology\"): _*);\n  var suspected = Set[Address]();\n  var seqnum = 0;\n\n  def startTimer(delay: Long): Unit = {\n    val scheduledTimeout = new ScheduleTimeout(period);\n    scheduledTimeout.setTimeoutEvent(CheckTimeout(scheduledTimeout));\n    trigger(scheduledTimeout -> timer);\n  }\n\n  //EPFD event handlers\n  ctrl uponEvent {\n    case _: Start => handle {\n        \n     /* MY CODE HERE  */\n     // Note: Initialization has been done in the\n     // field/variable declarations\n\n     // Start the first timeout timer\n     startTimer(period);\n     \n    }\n  }\n\n  timer uponEvent {\n    case CheckTimeout(_) => handle {\n      if (!alive.intersect(suspected).isEmpty) {\n          \n        /* MY CODE HERE  */\n        // There are some processes that are in both the alive and\n        // suspected sets.\n        // Increase the timeout delay\n        \n        period = period + delta;\n        \n      }\n      \n      seqnum = seqnum + 1;\n      \n      for (p <- topology) {\n        if (!alive.contains(p) && !suspected.contains(p)) {\n            \n           /* MY CODE HERE  */\n           // This process is neither in the set of alive processes\n           // nor suspected processes\n           // We have not received a heartbeat from him in this timeout round\n           // otherwise it would be in the alive set\n           \n           // So we add the process to the set of suspected processes\n           suspected = suspected + p;\n           \n           // Indicate that we now suspect the process\n           trigger(Suspect(p) -> epfd);\n           \n        } else if (alive.contains(p) && suspected.contains(p)) {\n          suspected = suspected - p;\n          trigger(Restore(p) -> epfd);\n        }\n        trigger(PL_Send(p, HeartbeatRequest(seqnum)) -> pLink);\n      }\n      alive = Set[Address]();\n      startTimer(period);\n    }\n  }\n\n  pLink uponEvent {\n    case PL_Deliver(src, HeartbeatRequest(seq)) => handle {\n        \n      /* MY CODE HERE  */\n      // Getting a heartbeat request from someone else\n      // Respond with a heartbeat reply\n      \n      trigger(PL_Send(src, HeartbeatReply(seq)) -> pLink);\n      \n    }\n    case PL_Deliver(src, HeartbeatReply(seq)) => handle {\n        \n      /* MY CODE HERE  */\n      // Am getting a heartbeat reply from someone.\n      // If this is a message with seqnum equal to my current seqnum (so this is\n      // a reply in this current timeout round) OR if the sender is suspected,\n      // add the sender to the list of known alive processes\n      \n      if ((seq == seqnum) || suspected.contains(src))\n      {\n          alive = alive + src;\n      }\n      \n    }\n  }\n};","dateUpdated":"2017-02-14T11:55:22+0000","config":{"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"editorMode":"ace/mode/scala","colWidth":12},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1487019058856_-43345527","id":"20160728-151056_2139297732","result":{"code":"SUCCESS","type":"HTML","msg":"defined class EPFD<br />"},"dateCreated":"2017-02-13T20:50:58+0000","dateStarted":"2017-02-14T11:55:22+0000","dateFinished":"2017-02-14T11:55:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:830","focus":true},{"text":"checkEPFD[EPFD]","dateUpdated":"2017-02-14T11:55:46+0000","config":{"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"editorMode":"ace/mode/scala","colWidth":12},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1487019058856_-43345527","id":"20160704-003955_2062490082","result":{"code":"SUCCESS","type":"HTML","msg":"<br />Your submission has been locally simulated and validated.<br /><br /><a href=\"\\static\\log.txt\" target=\"_blank\">Click Here</a> to view the output of the simulation.<br /><style type=\"text/css\">.tg  {border-collapse:collapse;border-spacing:0;border-color:#aabcfe;}.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aabcfe;color:#669;background-color:#e8edff;}.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aabcfe;color:#039;background-color:#b9c9fe;}.tg .tg-mb3i{background-color:#D2E4FC;text-align:right;vertical-align:top}.tg .tg-lqy6{text-align:right;vertical-align:top}.tg .tg-vlnx{background-color:#3071a9;color:#ffffff;text-align:center;vertical-align:top}.tg .tg-6k2t{background-color:#D2E4FC;vertical-align:top}.tg tg-6k2l{background-color:#ffb3b3;vertical-align:top}.tg .tg-yw4l{vertical-align:top}</style><table class=\"tg\">  <tr>    <th class=\"tg-vlnx\" colspan=\"3\">Correction Results</th>  </tr><br /><tr>    <td class=\"tg-6k2t\">PASSED</td> <td class=\"tg-6k2t\">Strong Completeness</td> <td class=\"tg-6k2t\">✔: Every process that crashes is eventually suspected permanently by every correct process<br></td>  </tr>  <br /><tr>    <td class=\"tg-6k2t\">PASSED</td> <td class=\"tg-6k2t\">Eventual Strong Accuracy</td> <td class=\"tg-6k2t\">✔: Eventually, no correct process is suspected by any correct process<br></td>  </tr>  <br /></table><br />Final Comments<br />**************<br />Congratulations! Your implementation of the 'Eventually Perfect Failure Detector' satisfies all properties! <br />A unique token has been generated for your submission right below. Please do not edit. <br /><br />{\"gradingToken\":[45,45,45,45,45,66,69,71,73,78,32,80,71,80,32,77,69,83,83,65,71,69,45,45,45,45,45,10,86,101,114,115,105,111,110,58,32,66,67,80,71,32,118,49,46,53,53,10,10,104,81,73,77,65,57,79,116,77,118,84,69,98,74,49,102,65,82,65,65,113,84,71,79,106,65,77,72,116,74,115,108,83,49,67,115,47,69,71,117,70,99,84,97,51,86,51,82,113,104,72,84,55,56,85,79,85,79,114,89,111,87,82,67,10,99,71,110,47,90,111,55,107,117,111,104,83,105,107,73,81,49,84,117,88,116,82,106,107,120,51,79,80,80,81,77,100,69,99,107,113,98,66,71,85,87,79,65,72,108,71,77,122,109,78,110,48,99,103,102,84,114,80,77,69,115,122,79,108,10,102,72,71,55,88,103,85,73,57,122,121,74,65,53,71,87,79,88,89,86,98,97,102,105,48,78,66,105,83,66,97,90,83,109,76,90,98,89,83,57,80,80,65,121,114,102,80,49,102,70,77,67,104,99,89,74,106,122,55,75,65,47,107,115,10,122,68,47,74,55,86,54,122,87,109,88,109,117,57,77,98,121,87,88,117,43,80,69,118,52,83,68,106,43,68,52,105,115,80,98,78,85,84,112,77,102,114,107,88,81,89,54,122,71,69,120,67,65,102,89,67,84,120,56,120,72,119,100,70,10,88,90,77,54,100,54,119,71,88,110,112,76,114,89,105,98,75,72,57,111,48,57,56,55,54,69,73,88,65,114,68,114,81,116,74,73,67,47,81,105,71,68,76,71,52,116,120,69,66,47,67,87,75,105,71,112,114,102,83,100,69,90,54,102,10,105,66,79,43,76,113,113,110,75,101,115,67,104,76,103,76,104,48,103,65,88,53,115,54,78,75,101,68,113,89,55,70,88,65,53,110,78,81,101,98,86,55,48,106,106,87,97,98,101,108,77,85,66,82,71,74,54,66,82,82,85,109,52,119,10,78,81,105,120,87,86,118,82,120,119,110,104,53,73,111,52,106,85,84,107,88,43,73,57,76,101,48,51,80,75,100,51,69,83,90,104,99,57,114,70,106,79,98,56,112,76,102,100,89,50,90,84,53,89,72,105,82,116,69,110,120,89,50,97,10,56,70,108,73,53,67,66,99,97,57,101,72,48,89,113,51,56,83,98,43,85,114,74,112,72,71,78,80,113,119,72,86,103,113,50,118,89,79,86,109,48,97,109,75,109,69,74,54,103,67,119,49,115,116,113,119,113,106,75,65,65,81,50,77,10,86,43,84,68,107,85,86,76,106,103,118,116,74,72,118,104,83,68,56,108,109,116,86,106,47,76,70,75,117,106,81,120,117,79,80,78,114,105,70,108,68,50,67,78,87,88,97,98,110,65,106,71,47,87,110,88,119,121,76,87,51,121,90,89,10,66,122,120,82,105,75,77,98,117,73,78,70,118,103,87,114,57,100,103,47,106,107,109,109,108,117,72,115,81,71,56,108,110,51,101,55,55,82,99,80,55,49,75,72,112,89,112,99,70,51,56,99,109,114,71,81,99,77,66,82,119,104,115,98,10,43,102,121,50,53,52,118,100,75,105,52,106,121,120,109,118,101,111,83,115,107,57,82,82,72,53,52,84,103,112,122,75,75,111,118,72,77,98,78,83,97,86,43,104,55,88,85,102,101,51,88,84,71,52,102,120,68,82,75,52,116,118,68,83,10,119,67,81,66,75,79,106,67,110,83,98,49,103,73,67,87,85,98,108,84,112,69,106,72,78,116,120,102,82,110,66,104,52,67,97,67,43,71,119,76,43,68,78,50,87,115,85,77,119,89,107,106,113,79,52,80,76,67,104,112,114,106,54,111,10,86,72,68,90,82,106,82,73,77,115,49,79,116,81,54,68,108,52,72,82,100,115,56,121,53,54,71,114,90,70,65,69,110,71,43,80,108,67,118,90,108,78,82,79,80,100,79,57,48,102,80,88,110,90,121,43,102,71,49,110,88,72,54,112,10,82,101,112,57,43,97,50,68,89,99,43,85,48,84,85,55,101,114,110,43,109,43,76,53,116,98,101,57,82,112,77,48,83,118,112,83,52,51,81,100,51,100,43,83,113,83,121,101,117,114,71,49,80,73,48,119,108,55,48,65,118,104,103,56,10,89,112,120,72,50,52,80,120,83,104,81,98,98,49,66,84,98,50,87,53,103,88,68,115,69,80,106,84,65,101,106,76,50,66,72,111,100,50,108,71,72,68,115,98,122,43,122,113,70,112,115,57,119,48,97,114,88,104,65,85,68,54,97,65,10,87,109,48,87,48,88,101,80,89,88,50,74,113,108,66,102,114,73,109,56,106,121,101,104,81,43,109,80,75,87,107,49,102,80,65,88,67,99,116,121,79,53,100,87,120,115,66,108,86,52,73,61,10,61,97,82,57,109,10,45,45,45,45,45,69,78,68,32,80,71,80,32,77,69,83,83,65,71,69,45,45,45,45,45,10]}<br />"},"dateCreated":"2017-02-13T20:50:58+0000","dateStarted":"2017-02-14T11:55:46+0000","dateFinished":"2017-02-14T11:55:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:831","focus":true},{"text":"","dateUpdated":"2017-02-13T20:50:58+0000","config":{"enabled":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"editorMode":"ace/mode/scala","colWidth":12},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1487019058856_-43345527","id":"20160728-143652_1894660652","dateCreated":"2017-02-13T20:50:58+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:832"}],"name":"Exercise: EPFD","id":"2C8D669DA","angularObjects":{"2BKQCVH92:shared_process":[],"2BMXUXUJ6:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}